<!-- FInal MCQ V9.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python MCQ Examination</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --white: #ffffff;
            --light-gray: #f8fafc;
            --medium-gray: #e2e8f0;
            --dark-gray: #334155;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
            --bg-color: #f8fafc;
            --text-color: #334155;
            --card-bg: #ffffff;
            --timer-color: #ef4444;
            --font-size-base: 16px;
        }

        /* Dark mode variables */
        [data-theme="dark"] {
            --bg-color: #1e293b;
            --text-color: #e2e8f0;
            --card-bg: #334155;
            --medium-gray: #475569;
            --light-gray: #1e293b;
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --primary-dark: #2563eb;
        }

        /* High contrast mode variables */
        [data-theme="high-contrast"] {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: #000000;
            --medium-gray: #333333;
            --light-gray: #222222;
            --primary: #ffffff;
            --primary-light: #ffffff;
            --primary-dark: #cccccc;
            --danger: #ff0000;
            --success: #00ff00;
            --warning: #ffff00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(37, 99, 235, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(37, 99, 235, 0.07) 0%, transparent 20%);
            font-size: var(--font-size-base);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Accessibility and Settings Panel */
        .settings-panel {
            position: fixed;
            /* moved down so it doesn't overlap the settings toggle button */
            top: 80px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 15px;
            z-index: 1001;
            display: none;
            flex-direction: column;
            gap: 10px;
            min-width: 200px;
        }

        .settings-panel.show {
            display: flex;
        }

        .settings-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            /* keep toggle above the settings panel so the button remains clickable when panel is open */
            z-index: 1002;
            font-size: 1.2rem;
        }

        .settings-toggle:hover {
            background-color: var(--primary-dark);
        }

        /* Theme indicator near the settings toggle */
        .theme-indicator {
            position: fixed;
            top: 26px;
            right: 86px; /* sits just left of the settings button */
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 6px 10px;
            border-radius: 999px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            font-size: 0.9rem;
            z-index: 1003;
            transition: transform 0.25s ease, opacity 0.25s ease, background-color 0.3s, color 0.3s;
            cursor: default;
        }

        .theme-indicator i {
            width: 16px;
            text-align: center;
        }

        /* Quick pulse/scale when theme changes */
        .theme-indicator.theme-change {
            transform: scale(1.08);
            opacity: 0.95;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-item label {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--medium-gray);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.toggle-slider {
            background-color: var(--primary);
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }

        .font-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .font-controls button {
            background-color: var(--medium-gray);
            border: none;
            color: var(--text-color);
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .font-controls button:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        /* Welcome Page Styles */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .welcome-page::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: var(--gradient-1);
            z-index: -1;
            border-radius: 0 0 50% 50% / 0 0 20% 20%;
        }

        .welcome-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .welcome-header i {
            font-size: 4rem;
            color: var(--white);
            margin-bottom: 20px;
            background: var(--gradient-1);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
            animation: pulse 2s infinite;
        }

        .welcome-header h1 {
            color: var(--white);
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .welcome-header p {
            color: rgba(0, 0, 0, 0.9);
            font-size: 1.2rem;
            margin-top: 10px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .instructions {
            border-left: 4px solid var(--primary);
            padding-left: 20px;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out 0.5s both;
        }

        .instructions h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }

        .instructions h2 i {
            margin-right: 10px;
        }

        .instructions ul {
            list-style-type: none;
        }

        .instructions li {
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            padding: 8px 0;
            transition: transform 0.2s ease;
        }

        .instructions li:hover {
            transform: translateX(5px);
        }

        .instructions li i {
            color: var(--primary);
            margin-right: 10px;
            margin-top: 5px;
        }

        .exam-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out 0.7s both;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            background: linear-gradient(145deg, var(--light-gray), var(--medium-gray));
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .info-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-1);
        }

        .info-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            position: relative;
            background-color: var(--card-bg);
            margin: 8% auto;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease-out;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .modal-body {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.1rem;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal .btn {
            min-width: 120px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .info-item i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .info-item .value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .info-item .label {
            font-size: 0.9rem;
            color: var(--text-color);
            text-align: center;
        }

        .form-container {
            animation: fadeIn 1s ease-out 0.9s both;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: var(--light-gray);
            color: var(--text-color);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background-color: var(--card-bg);
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 25px;
            padding: 15px;
            background-color: rgba(37, 99, 235, 0.05);
            border-radius: 8px;
        }

        .checkbox-group input {
            margin-right: 10px;
            margin-top: 5px;
            transform: scale(1.2);
        }

        .btn {
            background: var(--gradient-1);
            color: var(--white);
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn i {
            margin-right: 10px;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Exam Page Styles */
        .exam-page {
            display: none;
            min-height: 100vh;
            padding-top: 80px;
        }

        .exam-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding: 15px 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .exam-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .timer {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--timer-color);
            transition: color 0.3s ease;
        }

        .timer.warning {
            animation: pulse 1s infinite;
        }

        .timer i {
            margin-right: 8px;
        }

        .candidate-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .candidate-card {
            flex: 1;
            min-width: 200px;
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .candidate-card h3 {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .candidate-card p {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
        }

        .stat-card i {
            font-size: 1.5rem;
            margin-right: 15px;
            padding: 10px;
            border-radius: 50%;
        }

        .stat-card.answered i {
            color: var(--success);
            background-color: rgba(16, 185, 129, 0.1);
        }

        .stat-card.switches i {
            color: var(--warning);
            background-color: rgba(245, 158, 11, 0.1);
        }

        .stat-card.warnings i {
            color: var(--danger);
            background-color: rgba(239, 68, 68, 0.1);
        }

        .stat-card.save i {
            color: var(--primary);
            background-color: rgba(37, 99, 235, 0.1);
        }

        .stat-content h3 {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .stat-content p {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .progress-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .progress-bar {
            height: 10px;
            background-color: var(--medium-gray);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .question-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            transition: all 0.3s ease;
        }

        .questions-panel {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .question-card {
            border-bottom: 1px solid var(--medium-gray);
            padding: 20px 0;
            transition: all 0.3s ease;
        }

        .question-card:last-child {
            border-bottom: none;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .question-number {
            font-weight: 700;
            color: var(--primary);
        }

        .question-status {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 4px;
        }

        .status-unanswered {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .status-answered {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .option:hover {
            background-color: var(--light-gray);
        }

        .option input {
            margin-right: 10px;
            margin-top: 5px;
        }

        .navigator-panel {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .navigator-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .navigator-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-item {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-item.unanswered {
            background-color: var(--medium-gray);
            color: var(--text-color);
        }

        .nav-item.answered {
            background-color: var(--primary);
            color: var(--white);
        }

        .nav-item.current {
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .nav-item:hover {
            transform: scale(1.1);
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Result Page Styles */
        .result-page {
            display: none;
            min-height: 100vh;
            padding: 40px 0;
        }

        .result-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .result-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, var(--primary) var(--score-percent), var(--medium-gray) var(--score-percent), var(--medium-gray) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            position: relative;
        }

        .score-circle::before {
            content: "";
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--card-bg);
        }

        .score-value {
            position: relative;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-stat {
            padding: 15px;
            border-radius: 8px;
        }

        .result-stat.correct {
            background-color: rgba(16, 185, 129, 0.1);
        }

        .result-stat.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .result-stat.unanswered {
            background-color: rgba(245, 158, 11, 0.1);
        }

        .result-stat h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .result-stat.correct h3 {
            color: var(--success);
        }

        .result-stat.incorrect h3 {
            color: var(--danger);
        }

        .result-stat.unanswered h3 {
            color: var(--warning);
        }

        .result-stat p {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .time-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .time-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-stat i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .time-stat h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .time-stat p {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .notification.warning i {
            color: var(--warning);
        }

        .notification.error i {
            color: var(--danger);
        }

        .notification.info i {
            color: var(--primary);
        }

        .notification-content h3 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .notification-content p {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        /* Submit Confirmation Modal Styles */
        .submit-confirm-modal .modal-content {
            max-width: 600px;
            margin: 5% auto;
        }

        .submit-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .submit-detail-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--light-gray);
        }

        .submit-detail-item i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .submit-detail-item.answered i {
            color: var(--success);
        }

        .submit-detail-item.unanswered i {
            color: var(--danger);
        }

        .submit-detail-item.time i {
            color: var(--primary);
        }

        .submit-detail-item .value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .submit-detail-item.answered .value {
            color: var(--success);
        }

        .submit-detail-item.unanswered .value {
            color: var(--danger);
        }

        .submit-detail-item.time .value {
            color: var(--primary);
        }

        .submit-detail-item .label {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .modal-buttons .btn.cancel {
            background-color: var(--medium-gray);
        }

        .modal-buttons .btn.cancel:hover {
            background-color: var(--dark-gray);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Time warning styles */
        .time-warning {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--warning);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
        }

        .time-warning.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: var(--white);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .auto-save-indicator.show {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .auto-save-indicator i {
            font-size: 1rem;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(37, 99, 235, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
            }
        }

        /* Responsive Styles */
        /* Hide/Show pagination based on screen size */
        .mobile-top-pagination {
            display: none;
        }

        @media (max-width: 992px) {
            .question-container {
                grid-template-columns: 1fr;
            }

            .navigator-panel {
                position: static;
                margin-top: 20px;
            }

            .mobile-top-pagination {
                display: flex;
                margin-bottom: 15px;
            }

            .desktop-pagination {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            .exam-title {
                font-size: 1.2rem;
            }

            .timer {
                font-size: 1rem;
            }

            .candidate-info {
                flex-direction: column;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-stats {
                grid-template-columns: 1fr;
            }

            .time-stats {
                flex-direction: column;
                gap: 15px;
            }

            .navigator-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .submit-details {
                grid-template-columns: 1fr;
            }

            .submit-confirm-modal .modal-content {
                margin: 10% auto;
            }

            .settings-panel {
                right: 10px;
                top: 10px;
                min-width: 150px;
            }

            .settings-toggle {
                right: 10px;
                top: 10px;
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .welcome-header h1 {
                font-size: 2rem;
            }

            .card {
                padding: 15px;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .navigator-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .pagination {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 1rem;
            }

            .modal-buttons {
                flex-direction: column;
            }

            .submit-confirm-modal .modal-content {
                margin: 15% auto;
            }

            .question-text {
                font-size: 1rem;
            }

            .option {
                padding: 8px;
            }
        }

        /* Focus indicator for keyboard navigation */
        .option:focus-within,
        .nav-item:focus,
        .btn:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Touch-friendly controls */
        @media (hover: none) {
            .nav-item:hover {
                transform: none;
            }

            .nav-item:active {
                transform: scale(0.95);
            }

            .btn:hover {
                transform: none;
            }

            .btn:active {
                transform: scale(0.98);
            }
        }
    </style>
</head>

<body>
    <!-- Settings Panel -->
    <button class="settings-toggle" id="settingsToggle" aria-label="Settings" aria-expanded="false">
        <i class="fas fa-cog" aria-hidden="true"></i>
    </button>

    <!-- Theme indicator (shows current theme: Light / Dark) -->
    <div id="themeIndicator" class="theme-indicator" aria-live="polite" title="Current theme">
        <i class="fas fa-sun" aria-hidden="true"></i>
        <span class="theme-text">Light</span>
    </div>

    <div class="settings-panel" id="settingsPanel">
        <div class="setting-item">
            <label for="darkModeToggle">Dark Mode</label>
            <label class="toggle-switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="toggle-slider"></span>
            </label>
        </div>



        <div class="setting-item">
            <label>Font Size</label>
            <div class="font-controls">
                <button id="decreaseFont" aria-label="Decrease font size">
                    <i class="fas fa-minus"></i>
                </button>
                <button id="increaseFont" aria-label="Increase font size">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Welcome Page -->
    <div class="welcome-page" id="welcomePage">
        <div class="container">
            <div class="welcome-header">
                <i class="fas fa-laptop-code"></i>
                <h1>Python MCQ Examination</h1>
                <p>Test your Python knowledge with this comprehensive exam</p>
            </div>

            <div class="card">
                <div class="instructions">
                    <h2><i class="fas fa-info-circle"></i> Examination Instructions</h2>
                    <ul>
                        <li><i class="fas fa-check-circle"></i> This exam consists of 8 multiple-choice questions.</li>
                        <li><i class="fas fa-check-circle"></i> You will have 30 minutes to complete the exam.</li>
                        <li><i class="fas fa-check-circle"></i> Do not switch tabs or minimize the browser window during
                            the exam.</li>
                        <li><i class="fas fa-check-circle"></i> Copy, paste, and right-click are disabled during the
                            exam.</li>
                        <li><i class="fas fa-check-circle"></i> You are allowed a maximum of 3 tab switches before
                            auto-submission.</li>
                        <li><i class="fas fa-check-circle"></i> Your progress is automatically saved every 30 seconds.
                        </li>
                        <li><i class="fas fa-check-circle"></i> Questions will be presented in a randomized order for
                            each student.</li>
                        <li><i class="fas fa-check-circle"></i> Ensure a stable internet connection throughout the exam.
                        </li>
                        <li><i class="fas fa-check-circle"></i> Click Submit when you have completed all questions.</li>
                    </ul>
                </div>

                <div class="exam-info">
                    <div class="info-item">
                        <i class="fas fa-question-circle"></i>
                        <div class="value">8</div>
                        <div class="label">Total Questions</div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-list-ol"></i>
                        <div class="value">1</div>
                        <div class="label">Questions Per Page</div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-file-alt"></i>
                        <div class="value">8</div>
                        <div class="label">Total Pages</div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-exchange-alt"></i>
                        <div class="value">2</div>
                        <div class="label">Max Tab Switches</div>
                    </div>
                </div>

                <div class="form-container">
                    <form id="studentForm">
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" name="fullName" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="studentId">Student ID</label>
                            <input type="text" id="studentId" name="studentId" required>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="agreement" name="agreement" required>
                            <label for="agreement">I have read and agree to the examination instructions and
                                rules.</label>
                        </div>
                        <button type="submit" class="btn btn-block" id="startExamBtn" disabled>
                            <i class="fas fa-play"></i> Start Exam
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Exam Page -->
    <div class="exam-page" id="examPage">
        <div class="exam-header">
            <div class="header-content">
                <div class="exam-title">Python MCQ Examination</div>
                <div class="timer" id="timer">
                    <i class="fas fa-clock"></i>
                    <span id="timerDisplay">30:00</span>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="candidate-info">
                <div class="candidate-card">
                    <h3>Name</h3>
                    <p id="candidateName">-</p>
                </div>
                <div class="candidate-card">
                    <h3>Email</h3>
                    <p id="candidateEmail">-</p>
                </div>
                <div class="candidate-card">
                    <h3>Student ID</h3>
                    <p id="candidateId">-</p>
                </div>
            </div>

            <div class="stats-container">
                <div class="stat-card answered">
                    <i class="fas fa-check-circle"></i>
                    <div class="stat-content">
                        <h3>Answered</h3>
                        <p id="answeredCount">0</p>
                    </div>
                </div>
                <div class="stat-card switches">
                    <i class="fas fa-exchange-alt"></i>
                    <div class="stat-content">
                        <h3>Tab Switches</h3>
                        <p id="switchCount">0</p>
                    </div>
                </div>
                <div class="stat-card warnings">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="stat-content">
                        <h3>Warnings</h3>
                        <p id="warningCount">0</p>
                    </div>
                </div>
                <div class="stat-card save">
                    <i class="fas fa-save"></i>
                    <div class="stat-content">
                        <h3>Auto-save</h3>
                        <p id="saveStatus">Active</p>
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <h3>Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">0% Complete (0/20 questions)</p>
            </div>

            <div class="question-container">
                <div class="questions-panel" id="questionsPanel">
                    <!-- Questions will be dynamically inserted here -->
                </div>

                <div class="navigator-panel">
                    <div class="pagination mobile-top-pagination">
                        <button class="btn prevBtn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn nextBtn">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <h3 class="navigator-title">Question Navigator</h3>
                    <div class="navigator-grid" id="navigatorGrid">
                        <!-- Navigator items will be dynamically inserted here -->
                    </div>
                    <div class="pagination desktop-pagination">
                        <button class="btn prevBtn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn nextBtn">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <button class="btn btn-block" id="submitBtn"
                        style="margin-top: 20px; background-color: var(--success);">
                        <i class="fas fa-paper-plane"></i> Submit Exam
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Page -->
    <div class="result-page" id="resultPage">
        <div class="container">
            <div class="result-container">
                <h1 class="result-title">Examination Results</h1>

                <div class="score-circle" id="scoreCircle">
                    <div class="score-value" id="scoreValue">0%</div>
                </div>

                <div class="result-stats">
                    <div class="result-stat correct">
                        <h3 id="correctCount">0</h3>
                        <p>Correct Answers</p>
                    </div>
                    <div class="result-stat incorrect">
                        <h3 id="incorrectCount">0</h3>
                        <p>Incorrect Answers</p>
                    </div>
                    <div class="result-stat unanswered">
                        <h3 id="unansweredCount">0</h3>
                        <p>Unanswered Questions</p>
                    </div>
                </div>

                <div class="time-stats">
                    <div class="time-stat">
                        <i class="fas fa-hourglass-half"></i>
                        <h3 id="timeTaken">0:00</h3>
                        <p>Time Taken</p>
                    </div>
                    <div class="time-stat">
                        <i class="fas fa-exchange-alt"></i>
                        <h3 id="totalSwitches">0</h3>
                        <p>Tab Switches</p>
                    </div>
                    <div class="time-stat">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3 id="totalWarnings">0</h3>
                        <p>Warnings Received</p>
                    </div>
                </div>

                <button class="btn" id="downloadBtn">
                    <i class="fas fa-download"></i> Download Result (JSON)
                </button>
                <button class="btn" id="retakeBtn" style="margin-top: 15px; background-color: var(--primary);">
                    <i class="fas fa-redo"></i> Retake Exam
                </button>
            </div>
        </div>
    </div>

    <!-- Submit Confirmation Modal -->
    <div class="modal submit-confirm-modal" id="submitConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-paper-plane" style="color: var(--success);"></i>
                <h2>Confirm Exam Submission</h2>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to submit your exam? Please review your progress below:</p>

                <div class="submit-details">
                    <div class="submit-detail-item answered">
                        <i class="fas fa-check-circle"></i>
                        <div class="value" id="submitAnsweredCount">0</div>
                        <div class="label">Answered</div>
                    </div>
                    <div class="submit-detail-item unanswered">
                        <i class="fas fa-times-circle"></i>
                        <div class="value" id="submitUnansweredCount">0</div>
                        <div class="label">Unanswered</div>
                    </div>
                    <div class="submit-detail-item time">
                        <i class="fas fa-clock"></i>
                        <div class="value" id="submitRemainingTime">30:00</div>
                        <div class="label">Remaining Time</div>
                    </div>
                </div>

                <p>Once submitted, you will not be able to change your answers.</p>
            </div>
            <div class="modal-buttons">
                <button class="btn cancel" id="cancelSubmitBtn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn" id="confirmSubmitBtn" style="background-color: var(--success);">
                    <i class="fas fa-paper-plane"></i> Submit Exam
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification" id="notification">
        <i class="fas fa-exclamation-triangle"></i>
        <div class="notification-content">
            <h3 id="notificationTitle">Warning</h3>
            <p id="notificationMessage">This is a warning message.</p>
        </div>
    </div>

    <!-- Time Warning -->
    <div class="time-warning" id="timeWarning">
        <i class="fas fa-clock"></i> You've been on this question for over 2 minutes. Consider moving on.
    </div>

    <!-- Auto-save Indicator -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        <i class="fas fa-save"></i>
        <span>Saving...</span>
    </div>



 <script src="questions.js"></script>


 
    <script>
        

        // Application state
        let questions = [...originalQuestions];
        let currentPage = 0;
        let questionsPerPage = 1;
        let totalPages = Math.ceil(questions.length / questionsPerPage);
        let timer = null;
        let timeRemaining = 30 * 60; // 30 minutes in seconds
        let tabSwitchCount = 0;
        let warningCount = 0;
        let examStartTime = null;
        let examEndTime = null;
        let autoSaveInterval = null;
        let questionStartTime = null;
        let timeWarningShown = false;
        let focusLostCount = 0;
        let answerPattern = [];
        let isDarkMode = false;
        let fontSize = 16;

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const examPage = document.getElementById('examPage');
        const resultPage = document.getElementById('resultPage');
        const studentForm = document.getElementById('studentForm');
        const startExamBtn = document.getElementById('startExamBtn');
        const agreementCheckbox = document.getElementById('agreement');
        const fullNameInput = document.getElementById('fullName');
        const emailInput = document.getElementById('email');
        const studentIdInput = document.getElementById('studentId');
        const candidateName = document.getElementById('candidateName');
        const candidateEmail = document.getElementById('candidateEmail');
        const candidateId = document.getElementById('candidateId');
        const timerDisplay = document.getElementById('timerDisplay');
        const timerElement = document.getElementById('timer');
        const questionsPanel = document.getElementById('questionsPanel');
        const navigatorGrid = document.getElementById('navigatorGrid');
        const prevBtns = document.querySelectorAll('.prevBtn');
        const nextBtns = document.querySelectorAll('.nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const answeredCount = document.getElementById('answeredCount');
        const switchCount = document.getElementById('switchCount');
        const warningCountEl = document.getElementById('warningCount');
        const saveStatus = document.getElementById('saveStatus');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const scoreCircle = document.getElementById('scoreCircle');
        const scoreValue = document.getElementById('scoreValue');
        const correctCount = document.getElementById('correctCount');
        const incorrectCount = document.getElementById('incorrectCount');
        const unansweredCount = document.getElementById('unansweredCount');
        const timeTaken = document.getElementById('timeTaken');
        const totalSwitches = document.getElementById('totalSwitches');
        const totalWarnings = document.getElementById('totalWarnings');
        const downloadBtn = document.getElementById('downloadBtn');
        const retakeBtn = document.getElementById('retakeBtn');

        // Submit confirmation modal elements
        const submitConfirmModal = document.getElementById('submitConfirmModal');
        const cancelSubmitBtn = document.getElementById('cancelSubmitBtn');
        const confirmSubmitBtn = document.getElementById('confirmSubmitBtn');
        const submitAnsweredCount = document.getElementById('submitAnsweredCount');
        const submitUnansweredCount = document.getElementById('submitUnansweredCount');
        const submitRemainingTime = document.getElementById('submitRemainingTime');

        // Settings panel elements
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsPanel = document.getElementById('settingsPanel');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const decreaseFontBtn = document.getElementById('decreaseFont');
        const increaseFontBtn = document.getElementById('increaseFont');

        // Time warning and auto-save indicator elements
        const timeWarning = document.getElementById('timeWarning');
        const autoSaveIndicator = document.getElementById('autoSaveIndicator');

        // Event listeners
        agreementCheckbox.addEventListener('change', toggleStartButton);
        studentForm.addEventListener('submit', startExam);
        prevBtns.forEach(btn => btn.addEventListener('click', goToPreviousPage));
        nextBtns.forEach(btn => btn.addEventListener('click', goToNextPage));
        submitBtn.addEventListener('click', showSubmitConfirmation);
        cancelSubmitBtn.addEventListener('click', hideSubmitConfirmation);
        confirmSubmitBtn.addEventListener('click', submitExam);
        downloadBtn.addEventListener('click', downloadResults);
        retakeBtn.addEventListener('click', retakeExam);

        // Settings panel event listeners
        // (settingsToggle click listener is added later with stopPropagation to avoid immediate document click close)
        darkModeToggle.addEventListener('change', toggleDarkMode);
        decreaseFontBtn.addEventListener('click', decreaseFontSize);
        increaseFontBtn.addEventListener('click', increaseFontSize);

        // Keyboard navigation
        document.addEventListener('keydown', handleKeyboardNavigation);

        // Window focus tracking
        window.addEventListener('blur', handleWindowBlur);
        window.addEventListener('focus', handleWindowFocus);

        // Disable right-click, copy, and paste during exam
        document.addEventListener('contextmenu', e => {
            if (examPage.style.display === 'block') {
                e.preventDefault();
                showNotification('error', 'Action Blocked', 'Right-click is disabled during the exam.');
            }
        });

        document.addEventListener('copy', e => {
            if (examPage.style.display === 'block') {
                e.preventDefault();
                showNotification('error', 'Action Blocked', 'Copy is disabled during the exam.');
            }
        });

        document.addEventListener('paste', e => {
            if (examPage.style.display === 'block') {
                e.preventDefault();
                showNotification('error', 'Action Blocked', 'Paste is disabled during the exam.');
            }
        });

        // Track tab switches
        document.addEventListener('visibilitychange', () => {
            if (examPage.style.display === 'block' && document.hidden) {
                tabSwitchCount++;
                switchCount.textContent = tabSwitchCount;

                if (tabSwitchCount <= 2) {
                    warningCount++;
                    warningCountEl.textContent = warningCount;
                    showNotification('warning', 'Tab Switch Detected', `You have switched tabs ${tabSwitchCount} time(s). Maximum allowed: 2.`);

                    if (tabSwitchCount === 2) {
                        showNotification('error', 'Final Warning', 'This is your final warning. One more tab switch will auto-submit your exam.');
                    }
                } else {
                    // Auto-submit exam on 3rd tab switch
                    showNotification('error', 'Exam Auto-Submitted', 'You have exceeded the maximum allowed tab switches. Your exam has been submitted.');
                    submitExam();
                }
            }
        });

        // Initialize settings from localStorage
        function initializeSettings() {
            // Apply saved dark mode
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                darkModeToggle.checked = true;
                toggleDarkMode();
            }

            // Ensure theme indicator reflects current state on load
            if (typeof updateThemeIndicator === 'function') updateThemeIndicator();

            // Font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                fontSize = parseInt(savedFontSize);
                document.documentElement.style.setProperty('--font-size-base', `${fontSize}px`);
            }
        }

        // Settings panel functions
        function toggleSettingsPanel() {
            // Toggle visible class
            const isShown = settingsPanel.classList.toggle('show');
            // Update aria-expanded on the toggle button for accessibility
            settingsToggle.setAttribute('aria-expanded', isShown ? 'true' : 'false');
        }

        // Close settings panel when clicking outside of it
        document.addEventListener('click', (e) => {
            // If panel isn't shown, nothing to do
            if (!settingsPanel.classList.contains('show')) return;

            // If click is inside the panel or on the toggle button, keep it open
            if (settingsPanel.contains(e.target) || settingsToggle.contains(e.target)) return;

            // Otherwise close it
            settingsPanel.classList.remove('show');
            settingsToggle.setAttribute('aria-expanded', 'false');
        });

        // Prevent clicks on the toggle button from bubbling to document (which would immediately close it)
        settingsToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleSettingsPanel();
        });

        // Close with Escape key for accessibility when panel is open
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && settingsPanel.classList.contains('show')) {
                settingsPanel.classList.remove('show');
                settingsToggle.setAttribute('aria-expanded', 'false');
            }
        });

        function toggleDarkMode() {
            isDarkMode = darkModeToggle.checked;
            if (isDarkMode) {
                // Enable dark mode
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('darkMode', 'true');
            } else {
                // Disable dark mode and fall back to light mode
                localStorage.setItem('darkMode', 'false');
                document.documentElement.removeAttribute('data-theme');
            }
            // Update theme indicator visual
            if (typeof updateThemeIndicator === 'function') updateThemeIndicator();
        }

        // Update the small theme indicator: icon/text and a tiny animation
        function updateThemeIndicator() {
            const indicator = document.getElementById('themeIndicator');
            if (!indicator) return;
            const icon = indicator.querySelector('i');
            const text = indicator.querySelector('.theme-text');

            if (document.documentElement.getAttribute('data-theme') === 'dark') {
                // dark
                icon.className = 'fas fa-moon';
                text.textContent = 'Dark';
            } else {
                // light
                icon.className = 'fas fa-sun';
                text.textContent = 'Light';
            }

            // animate briefly
            indicator.classList.add('theme-change');
            setTimeout(() => indicator.classList.remove('theme-change'), 350);
        }



        function decreaseFontSize() {
            if (fontSize > 12) {
                fontSize -= 2;
                document.documentElement.style.setProperty('--font-size-base', `${fontSize}px`);
                localStorage.setItem('fontSize', fontSize);
            }
        }

        function increaseFontSize() {
            if (fontSize < 24) {
                fontSize += 2;
                document.documentElement.style.setProperty('--font-size-base', `${fontSize}px`);
                localStorage.setItem('fontSize', fontSize);
            }
        }

        // Keyboard navigation
        function handleKeyboardNavigation(e) {
            if (examPage.style.display !== 'block') return;

            // Left arrow key - previous question
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                goToPreviousPage();
            }

            // Right arrow key - next question
            if (e.key === 'ArrowRight') {
                e.preventDefault();
                goToNextPage();
            }

            // Number keys 1-4 - select option
            if (e.key >= '1' && e.key <= '4') {
                e.preventDefault();
                const optionIndex = parseInt(e.key) - 1;
                const currentQuestion = questions[currentPage];
                if (currentQuestion && currentQuestion.options[optionIndex]) {
                    selectAnswer(currentQuestion.id, currentQuestion.options[optionIndex].id);
                }
            }

            // Enter key - submit if on last question
            if (e.key === 'Enter' && currentPage === totalPages - 1) {
                e.preventDefault();
                showSubmitConfirmation();
            }

            // Escape key - close settings panel if open
            if (e.key === 'Escape' && settingsPanel.classList.contains('show')) {
                settingsPanel.classList.remove('show');
            }
        }

        // Window focus tracking
        function handleWindowBlur() {
            if (examPage.style.display === 'block') {
                focusLostCount++;

                if (focusLostCount === 1) {
                    showNotification('warning', 'Focus Lost', 'Browser window lost focus. Please focus on the exam window.');
                } else if (focusLostCount === 3) {
                    showNotification('error', 'Multiple Focus Loss', 'You have lost focus multiple times. This may be flagged as suspicious activity.');
                }
            }
        }

        function handleWindowFocus() {
            // Reset warning when focus is regained
            if (examPage.style.display === 'block') {
                // Additional tracking can be added here
            }
        }

        // Time management functions
        function checkQuestionTime() {
            if (!questionStartTime) return;

            const currentTime = new Date();
            const timeSpent = Math.floor((currentTime - questionStartTime) / 1000); // in seconds

            // Show warning if spent more than 2 minutes on a question
            if (timeSpent > 120 && !timeWarningShown) {
                timeWarning.classList.add('show');
                timeWarningShown = true;

                // Hide warning after 5 seconds
                setTimeout(() => {
                    timeWarning.classList.remove('show');
                }, 5000);
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // Change color when time is running low
            if (timeRemaining <= 120) { // 2 minutes
                timerElement.classList.add('warning');
                timerDisplay.style.color = 'var(--danger)';
            } else if (timeRemaining <= 600) { // 10 minutes
                timerDisplay.style.color = 'var(--warning)';
            } else {
                timerElement.classList.remove('warning');
                timerDisplay.style.color = 'var(--timer-color)';
            }
        }

        // Functions
        function toggleStartButton() {
            startExamBtn.disabled = !agreementCheckbox.checked ||
                !fullNameInput.value.trim() ||
                !emailInput.value.trim() ||
                !studentIdInput.value.trim();
        }

        function startExam(e) {
            e.preventDefault();

            // Set candidate information
            candidateName.textContent = fullNameInput.value;
            candidateEmail.textContent = emailInput.value;
            candidateId.textContent = studentIdInput.value;

            // Shuffle questions
            questions = shuffleArray([...originalQuestions]);

            // Reset exam state
            currentPage = 0;
            tabSwitchCount = 0;
            warningCount = 0;
            timeRemaining = 30 * 60; // 30 minutes in seconds
            examStartTime = new Date();
            questionStartTime = new Date();
            timeWarningShown = false;
            focusLostCount = 0;
            answerPattern = [];

            // Update UI
            switchCount.textContent = tabSwitchCount;
            warningCountEl.textContent = warningCount;
            answeredCount.textContent = '0';
            updateProgress();

            // Show exam page
            welcomePage.style.display = 'none';
            examPage.style.display = 'block';

            // Render questions
            renderQuestions();
            renderNavigator();

            // Start timer
            startTimer();

            // Start time checking for current question
            startQuestionTimeCheck();

            // Start auto-save
            startAutoSave();

            // Close settings panel if open
            settingsPanel.classList.remove('show');
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function startTimer() {
            updateTimerDisplay();

            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    showNotification('error', 'Time Expired', 'Your time has expired. The exam will be submitted automatically.');
                    submitExam();
                }
            }, 1000);
        }

        function startQuestionTimeCheck() {
            // Check every 5 seconds if user is spending too much time on a question
            const questionTimeCheckInterval = setInterval(() => {
                if (examPage.style.display !== 'block') {
                    clearInterval(questionTimeCheckInterval);
                    return;
                }

                checkQuestionTime();
            }, 5000);
        }

        function renderQuestions() {
            questionsPanel.innerHTML = '';

            const startIndex = currentPage * questionsPerPage;
            const endIndex = Math.min(startIndex + questionsPerPage, questions.length);

            for (let i = startIndex; i < endIndex; i++) {
                const question = questions[i];
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';

                const questionHeader = document.createElement('div');
                questionHeader.className = 'question-header';

                const questionNumber = document.createElement('div');
                questionNumber.className = 'question-number';
                questionNumber.textContent = `Question ${i + 1}`;

                const questionStatus = document.createElement('div');
                questionStatus.className = 'question-status';
                questionStatus.textContent = question.userAnswer !== undefined ? 'Answered' : 'Unanswered';
                questionStatus.classList.add(question.userAnswer !== undefined ? 'status-answered' : 'status-unanswered');

                questionHeader.appendChild(questionNumber);
                questionHeader.appendChild(questionStatus);

                const questionText = document.createElement('div');
                questionText.className = 'question-text';
                questionText.textContent = question.text;

                // Append header and text
                questionCard.appendChild(questionHeader);
                questionCard.appendChild(questionText);

                // Add image if present
                if (question.imageUrl) {
                    const imageDiv = document.createElement('img');
                    imageDiv.src = question.imageUrl;
                    imageDiv.style.width = '100%';
                    imageDiv.style.maxWidth = '600px';
                    imageDiv.style.height = 'auto';
                    imageDiv.style.borderRadius = '8px';
                    imageDiv.style.margin = '15px 0';
                    imageDiv.style.display = 'block';
                    questionCard.appendChild(imageDiv);
                }

                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options';

                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.setAttribute('tabindex', '0'); // Make focusable for keyboard navigation

                    const optionInput = document.createElement('input');
                    optionInput.type = 'radio';
                    optionInput.id = `q${question.id}_${option.id}`;
                    optionInput.name = `question_${question.id}`;
                    optionInput.value = option.id;
                    optionInput.checked = question.userAnswer === option.id;
                    optionInput.addEventListener('change', () => selectAnswer(question.id, option.id));

                    const optionLabel = document.createElement('label');
                    optionLabel.htmlFor = `q${question.id}_${option.id}`;
                    optionLabel.textContent = `${option.id}. ${option.text}`;

                    optionDiv.appendChild(optionInput);
                    optionDiv.appendChild(optionLabel);
                    optionsContainer.appendChild(optionDiv);

                    // Add keyboard event listener to option
                    optionDiv.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            optionInput.checked = true;
                            selectAnswer(question.id, option.id);
                        }
                    });
                });

                questionCard.appendChild(optionsContainer);
                questionsPanel.appendChild(questionCard);
            }

            // Update pagination buttons
            prevBtns.forEach(btn => btn.disabled = currentPage === 0);
            nextBtns.forEach(btn => btn.disabled = currentPage === totalPages - 1);

            // Add smooth transition
            questionsPanel.style.opacity = '0';
            setTimeout(() => {
                questionsPanel.style.opacity = '1';
            }, 100);
        }

        function renderNavigator() {
            navigatorGrid.innerHTML = '';

            questions.forEach((question, index) => {
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.textContent = index + 1;
                navItem.setAttribute('tabindex', '0'); // Make focusable for keyboard navigation
                navItem.setAttribute('aria-label', `Question ${index + 1}`);

                if (question.userAnswer !== undefined) {
                    navItem.classList.add('answered');
                } else {
                    navItem.classList.add('unanswered');
                }

                if (index >= currentPage * questionsPerPage && index < (currentPage + 1) * questionsPerPage) {
                    navItem.classList.add('current');
                }

                navItem.addEventListener('click', () => goToQuestion(index));

                // Add keyboard event listener
                navItem.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        goToQuestion(index);
                    }
                });

                navigatorGrid.appendChild(navItem);
            });
        }

        function selectAnswer(questionId, answerId) {
            const question = questions.find(q => q.id === questionId);
            if (question) {
                // Record answer pattern for cheating detection
                const previousAnswer = question.userAnswer;
                question.userAnswer = answerId;

                // Track answer pattern
                if (previousAnswer !== answerId) {
                    answerPattern.push({
                        questionId: questionId,
                        answer: answerId,
                        timestamp: new Date(),
                        timeSpent: questionStartTime ? Math.floor((new Date() - questionStartTime) / 1000) : 0
                    });
                }

                updateProgress();
                renderQuestions();
                renderNavigator();

                // Reset question time tracking
                questionStartTime = new Date();
                timeWarningShown = false;
            }
        }

        function goToQuestion(index) {
            currentPage = Math.floor(index / questionsPerPage);
            renderQuestions();
            renderNavigator();

            // Reset question time tracking
            questionStartTime = new Date();
            timeWarningShown = false;
        }

        function goToPreviousPage() {
            if (currentPage > 0) {
                currentPage--;
                renderQuestions();
                renderNavigator();

                // Reset question time tracking
                questionStartTime = new Date();
                timeWarningShown = false;
            }
        }

        function goToNextPage() {
            if (currentPage < totalPages - 1) {
                currentPage++;
                renderQuestions();
                renderNavigator();

                // Reset question time tracking
                questionStartTime = new Date();
                timeWarningShown = false;
            }
        }

        function updateProgress() {
            const answered = questions.filter(q => q.userAnswer !== undefined).length;
            const progress = (answered / questions.length) * 100;

            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}% Complete (${answered}/${questions.length} questions)`;
            answeredCount.textContent = answered;

            // Update CSS variable for score circle
            document.documentElement.style.setProperty('--score-percent', `${progress}%`);
        }

        function startAutoSave() {
            saveStatus.textContent = 'Active';

            autoSaveInterval = setInterval(() => {
                // Show auto-save indicator
                autoSaveIndicator.classList.add('show');

                // In a real application, this would save to a server
                setTimeout(() => {
                    saveStatus.textContent = 'Saved';
                    autoSaveIndicator.classList.remove('show');

                    setTimeout(() => {
                        saveStatus.textContent = 'Active';
                    }, 2000);
                }, 1000);
            }, 30000); // Save every 30 seconds
        }

        function showSubmitConfirmation() {
            const answered = questions.filter(q => q.userAnswer !== undefined).length;
            const unanswered = questions.length - answered;

            // Update confirmation modal details
            submitAnsweredCount.textContent = answered;
            submitUnansweredCount.textContent = unanswered;
            submitRemainingTime.textContent = timerDisplay.textContent;

            // Show modal
            submitConfirmModal.style.display = 'block';
        }

        function hideSubmitConfirmation() {
            submitConfirmModal.style.display = 'none';
        }

        function submitExam() {
            // Hide confirmation modal if it's open
            hideSubmitConfirmation();

            // Stop timer and auto-save
            clearInterval(timer);
            clearInterval(autoSaveInterval);

            // Record end time
            examEndTime = new Date();

            // Calculate results
            const correct = questions.filter(q => q.userAnswer === q.correctAnswer).length;
            const incorrect = questions.filter(q => q.userAnswer !== undefined && q.userAnswer !== q.correctAnswer).length;
            const unanswered = questions.filter(q => q.userAnswer === undefined).length;
            const score = Math.round((correct / questions.length) * 100);

            // Calculate time taken
            const timeDiff = examEndTime - examStartTime;
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000);

            // Update result page
            scoreValue.textContent = `${score}%`;
            correctCount.textContent = correct;
            incorrectCount.textContent = incorrect;
            unansweredCount.textContent = unanswered;
            timeTaken.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            totalSwitches.textContent = tabSwitchCount;
            totalWarnings.textContent = warningCount;

            // Update score circle
            document.documentElement.style.setProperty('--score-percent', `${score}%`);

            // Show result page
            examPage.style.display = 'none';
            resultPage.style.display = 'block';
        }

        function downloadResults() {
            const correct = questions.filter(q => q.userAnswer === q.correctAnswer).length;
            const incorrect = questions.filter(q => q.userAnswer !== undefined && q.userAnswer !== q.correctAnswer).length;
            const unanswered = questions.filter(q => q.userAnswer === undefined).length;
            const score = Math.round((correct / questions.length) * 100);

            const timeDiff = examEndTime - examStartTime;
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000);

            // Analyze answer patterns for cheating detection
            const suspiciousPatterns = analyzeAnswerPatterns();

            const results = {
                candidate: {
                    name: candidateName.textContent,
                    email: candidateEmail.textContent,
                    studentId: candidateId.textContent
                },
                exam: {
                    title: "Python MCQ Examination",
                    totalQuestions: questions.length,
                    timeLimit: "30 minutes",
                    startTime: examStartTime.toLocaleString('en-US', { timeZone: 'Asia/Dhaka' }),
                    submissionTime: new Date().toLocaleString('en-US', { timeZone: 'Asia/Dhaka' })
                },
                performance: {
                    score: score,
                    correct: correct,
                    incorrect: incorrect,
                    unanswered: unanswered,
                    timeTaken: `${minutes} minutes ${seconds} seconds`,
                    tabSwitches: tabSwitchCount,
                    warnings: warningCount,
                    focusLossEvents: focusLostCount,
                    suspiciousActivity: suspiciousPatterns.length > 0,
                    suspiciousPatterns: suspiciousPatterns
                },
                answers: questions
                    // Filter out unanswered questions
                    .filter(q => q.userAnswer !== undefined)
                    .map(q => {
                        // Get the text of the selected answer
                        const selectedOption = q.options.find(opt => opt.id === q.userAnswer);
                        const selectedAnswerText = selectedOption ? selectedOption.text : "Not answered";

                        // Get the text of the correct answer
                        const correctOption = q.options.find(opt => opt.id === q.correctAnswer);
                        const correctAnswerText = correctOption ? correctOption.text : "";

                        // Determine if the answer is correct and set the appropriate icon
                        const isCorrectIcon = q.userAnswer === q.correctAnswer ? "" : "";

                        return {
                            question: q.text,
                            selectedAnswer: selectedAnswerText,
                            correctAnswer: correctAnswerText,
                            isCorrect: isCorrectIcon,
                            source: q.source
                        };
                    })
            };

            const dataStr = JSON.stringify(results, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

            const exportFileDefaultName = `${candidateName.textContent}_${candidateId.textContent}_python_mid_exam_results.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function analyzeAnswerPatterns() {
            const patterns = [];

            // Check for uniform answer patterns (e.g., all 'A's)
            const answerCounts = {};
            questions.forEach(q => {
                if (q.userAnswer) {
                    answerCounts[q.userAnswer] = (answerCounts[q.userAnswer] || 0) + 1;
                }
            });

            // Check if one answer is selected more than 70% of the time
            const totalAnswered = questions.filter(q => q.userAnswer).length;
            for (const [answer, count] of Object.entries(answerCounts)) {
                if (count / totalAnswered > 0.7) {
                    patterns.push({
                        type: "Uniform Answer Pattern",
                        description: `${((count / totalAnswered) * 100).toFixed(1)}% of answers were '${answer}'`,
                        severity: "medium"
                    });
                }
            }

            // Check for unusually fast answering (less than 5 seconds per question on average)
            if (answerPattern.length > 0) {
                const totalTimeSpent = answerPattern.reduce((sum, answer) => sum + answer.timeSpent, 0);
                const avgTimePerQuestion = totalTimeSpent / answerPattern.length;

                if (avgTimePerQuestion < 5) {
                    patterns.push({
                        type: "Unusually Fast Answering",
                        description: `Average time per question: ${avgTimePerQuestion.toFixed(1)} seconds`,
                        severity: "high"
                    });
                }
            }

            // Check for multiple changes to answers
            const changeCount = answerPattern.filter((answer, index, arr) => {
                return index > 0 && arr[index - 1].questionId === answer.questionId;
            }).length;

            if (changeCount > questions.length * 0.3) {
                patterns.push({
                    type: "Excessive Answer Changes",
                    description: `${changeCount} answer changes detected (${((changeCount / questions.length) * 100).toFixed(1)}% of questions)`,
                    severity: "medium"
                });
            }

            return patterns;
        }

        function retakeExam() {
            // Reset exam state
            questions = [...originalQuestions];
            currentPage = 0;
            tabSwitchCount = 0;
            warningCount = 0;
            timeRemaining = 30 * 60; // 30 minutes in seconds
            examStartTime = null;
            examEndTime = null;
            questionStartTime = null;
            timeWarningShown = false;
            focusLostCount = 0;
            answerPattern = [];

            // Reset UI
            fullNameInput.value = '';
            emailInput.value = '';
            studentIdInput.value = '';
            agreementCheckbox.checked = false;
            startExamBtn.disabled = true;

            // Show welcome page
            resultPage.style.display = 'none';
            welcomePage.style.display = 'flex';
        }

        function showNotification(type, title, message) {
            notification.className = 'notification';
            notification.classList.add(type);
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Initialize form validation and settings
        fullNameInput.addEventListener('input', toggleStartButton);
        emailInput.addEventListener('input', toggleStartButton);
        studentIdInput.addEventListener('input', toggleStartButton);

        // Initialize settings on page load
        // Initialize settings on page load
        // NOTE: settings toggle behavior improved - toggle button now stops propagation,
        // supports aria-expanded, and clicking outside or pressing Escape will close the panel.
        document.addEventListener('DOMContentLoaded', initializeSettings);
    </script>
</body>

</html>
